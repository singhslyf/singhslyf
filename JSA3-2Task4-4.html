<!DOCTYPE html>
<html>
  <head>
    <style>
      .td1 {
        color: white;
        border-collapse: collapse;
        border: 1px solid black;
        text-align: center;
        padding-left: 50px;
        padding-right: 50px;
      }
      .table1 {
        margin-top: 15px;
        border: 1px solid black;
        border-collapse: collapse;
        margin-bottom: 10px;
      }
      .red {
        background-color: red;
      }
      .grey {
        background-color: grey;
      }
      .green {
        background-color: green;
      }
      .headrow {
        background-color: black;
      }
    </style>
  </head>

  <body>
    <div id="form1"></div>
    <div id="persons"></div>
    <div id="form2"></div>
    <script>
      let persons = [
        { name: "Jack", oldwt: 65, newwt: 68 },
        { name: "Mary", oldwt: 55, newwt: 53 },
        { name: "Bob", oldwt: 71, newwt: 66 },
        { name: "Steve", oldwt: 62, newwt: 68 },
        { name: "James", oldwt: 81, newwt: 77 },
        { name: "Julia", oldwt: 52, newwt: 52 },
        { name: "Michael", oldwt: 68, newwt: 68 },
        { name: "Bill", oldwt: 60, newwt: 61 },
        { name: "Sonny", oldwt: 61, newwt: 82 },
      ];

      let f = [];
      let t = -1;
      function getValue() {
        if (t != -1) {
          return f;
        } else {
          return persons;
        }
      }

      let nwwt = [];
      function nwtarr() {
        let m = minwt();
        let n = maxwt();
        for (let i = m; i <= n; i++) {
          let m = nwwt.find(function (r) {
            return r == i;
          });
          if (m) {
          } else {
            nwwt.push(i);
          }
        }
        nwwt.sort();
      }

      let b = [];
      function nwarr() {
        for (let i = 1; i <= 100; i++) {
          b.push(i);
        }
      }
      nwarr();
      //console.log(nwwt);
      function maxwt() {
        let a1 = persons.reduce(function (acc, curr) {
          //console.log(curr.newwt, acc);
          if (curr.newwt > acc) {
            return (acc = curr.newwt);
          } else {
            return acc;
          }
        }, 0);
        //console.log(i);
        //console.log(a1);
        return a1;
      }
      function minwt() {
        let a1 = persons.reduce(function (acc, curr) {
          //console.log(curr.newwt, acc);
          if (curr.newwt < acc.newwt) {
            acc = curr;
            //console.log(acc);
            return acc;
          } else {
            //console.log(acc);
            return acc;
          }
        });
        //console.log(a1.newwt);
        return a1.newwt;
      }
      //maxwt();
      //console.log(b);
      
      showPersons(persons);

      function showPersons(arr) {
        // console.log(nwwt);
start();
        let v1 = getValue();
        let arr1 = v1.map(function (ele) {
          let st = '<tr class="' + getColor(ele.newwt, ele.oldwt) + '">';
          st += '<td class="td1">' + ele.name + "</td>";
          st += '<td class="td1">' + ele.oldwt + "</td>";
          st += '<td class="td1">' + ele.newwt + "</td>";
          st += "</tr>";
          return st;
        });
        let header = '<tr class="headrow">';
        header += '<th class="td1" onClick=" sort(0) ">Name</th>';
        header += '<th class="td1" onClick=" sort(1) ">Old Weight</th>';
        header += '<th class="td1" onClick=" sort(2)">New Weight</th>';
        header += "</tr>";

        let html =
          '<table class="table1">' + header + arr1.join(" ") + "</table>";
        //console.log(html);
        let element = document.getElementById("persons");
        element.innerHTML = html;
      }

      function getColor(n, o) {
        if (n > o) {
          //console.log("Red");
          return "red";
        } else if (n == o) {
          //console.log("Grey");
          return "grey";
        } else if (n < o) {
          //console.log("green");
          return "green";
        }
      }

      function sortoWt(st1, st2) {
        if (st1.oldwt > st2.newwt) return -1;
        else if (st1.oldwt < st2.newwt) return 1;
        else return 0;
      }

      function sortnWt(st1, st2) {
        if (st1.newwt > st2.oldwt) return -1;
        else if (st1.newwt < st2.oldwt) return 1;
        else return 0;
      }

      function desName(st1, st2) {
        return -1 * st1.name.localeCompare(st2.name);
      }

      function sort(colno) {
        if (colno == 0) {
          persons.sort(desName);
        } else if (colno == 1) {
          persons.sort(sortoWt);
        } else {
          persons.sort(sortnWt);
        }
        //console.log(persons);
        showPersons(persons);
      }

      function start() {
        nwtarr();
        let str = "New Weight Between: &nbsp;&nbsp;";
        str += makeDD2(nwwt, "select new weight") + "&nbsp;&nbsp;";
        str += makeDD22(nwwt, "select new weight") + "<br />";

        str += '<button onclick="filter()">Filter</button>&nbsp;&nbsp;';
        str += '<button onclick="clar()">clear filter</button>&nbsp;&nbsp;';
        str += '<button onclick="addNew()">Add New Member</button>';
        let element = document.getElementById("form1");
        element.innerHTML = str;
        return str;
      }
      function filter() {
        let wt1 = document.getElementById("new weight1").value;
        let wt2 = document.getElementById("new weight2").value;
        f = persons.filter(function (p) {
          return p.newwt >= wt1 && p.newwt <= wt2;
        });
        t = 0;
        showPersons(f);
      }
      function addNew() {
        let str = "<h1>List of students</h1><br/>";
        str += 'Name:<input type="text" id="name"><br/>';
        str += makeDD1(b, "select old weight") + "<br/>";
        str += makeDD0(b, "select new weight") + "<br/>";
        str += '<button onclick="addd()">Add</button>';
        element = document.getElementById("form2");
        element.innerHTML = str;
        return str;
      }

      function makeDD1(arr, firstItem) {
        let arr1 = arr.map(function (opt) {
          return "<option>" + opt + "</option>";
        });
        let first = "<option disabled selected>" + firstItem + "</option>";
        let s1 =
          '<select id="old weight">' + first + arr1.join("") + "</select>";
        return s1;
      }
      function makeDD0(arr, firstItem) {
        let arr1 = arr.map(function (opt) {
          return "<option>" + opt + "</option>";
        });
        let first = "<option disabled selected>" + firstItem + "</option>";
        let s1 =
          '<select id="new weight">' + first + arr1.join("") + "</select>";
        return s1;
      }

      function makeDD2(arr, firstItem) {
        // console.log(selVal);
        let arr1 = arr.map(function (opt) {
          return "<option>" + opt + "</option>";
        });
        let first = "<option disabled selected>" + firstItem + "</option>";
        let s1 =
          '<select id="new weight1">' + first + arr1.join("") + "</select>";
        return s1;
      }
      function makeDD22(arr, firstItem) {
        let arr1 = arr.map(function (opt) {
          return "<option>" + opt + "</option>";
        });
        let first = "<option disabled selected>" + firstItem + "</option>";
        let s1 =
          '<select id="new weight2" >' + first + arr1.join("") + "</select>";

        return s1;
      }
      function addd() {
        let st = {};
        st.name = document.getElementById("name").value;
        //console.log(st.name);
        st.oldwt = document.getElementById("old weight").value;
        st.newwt = document.getElementById("new weight").value;
        persons.push(st);
        nwtarr();
        // console.log(nwwt);
        
        showPersons(persons);
        //console.log(persons);
      }

      function clar() {
        //console.log("india");
        start();
        let arr1 = persons.map(function (ele) {
          let st = '<tr class="' + getColor(ele.newwt, ele.oldwt) + '">';
          st += '<td class="td1">' + ele.name + "</td>";
          st += '<td class="td1">' + ele.oldwt + "</td>";
          st += '<td class="td1">' + ele.newwt + "</td>";
          st += "</tr>";
          return st;
        });
        let header = '<tr class="headrow">';
        header += '<th class="td1" onClick=" sort(0) ">Name</th>';
        header += '<th class="td1" onClick=" sort(1) ">Old Weight</th>';
        header += '<th class="td1" onClick=" sort(2)">New Weight</th>';
        header += "</tr>";

        let html =
          '<table class="table1">' + header + arr1.join(" ") + "</table>";
        //console.log(html);
        let element = document.getElementById("persons");
        element.innerHTML = html;
      }
    </script>
  </body>
</html>
